# compile.js
Compiles JavaScript into another JavaScript file that has only functions and gotos.

To compile a file with name filename.js:

    node src/js/compiler/compile.js filename.js

The above command generates the file filename.js.js.  To run the generated code run the file with node.

    node filename.js.js

For example, try the following two commands:

    node src/js/compiler/compile.js tests/sunspider/access-binary-trees.js
    node tests/sunspider/access-binary-trees.js.js

# Generating C

To generate C code, change the following line in [src/js/compiler/compile.js](src/js/compiler/compile.js)

        var targetLang = "JS";

to

        var targetLang = "C";

compile.js will then generate filename.js.c.

Compile the resulting C code, start with a checkout of the ```objectmodel``` branch of the SJS
compiler, which has additional runtime primitives to support untyped execution.  

Temporarily, linking against the SJS runtime requires the following additional steps until some
refactoring of the SJS runtime:

1. Create a JavaScript
file (an SJS source file) that uses any field names that are used in the dynamic JavaScript program
(for example, if the program you care about uses properties ```a``` and ```b```, simply allocating
an object literal with those properties in the SJS file will suffice).
2. Compile the "dummy" SJS file using the ```--only-c --guest-runtime``` flags.  This will produce a
   .c file that defines several global variables required by the SJS runtime.  No code from this
   file will be executed.

With the above dummy file in hand:

    ./clang.sh -DUSE_GC /path/to/filename.js.c dummy.c
    ./a.out

## Completing C Primitives
The SJS runtime primitives supporting jscomp-compiled programs are incomplete --- they do not yet
model most JavaScript semantics, in particular implicit coercions.  The primitives are defined in
the SJS source tree (only on the ```objectmodel``` branch) in

    src/main/resources/backend/interop.h
    src/main/resources/backend/interop.c

If a jscomp-compiled program misbehaves, the primitives in those files likely need to be extended.

*Do not modify the ```value_t``` or ```object_t``` structures*.  Doing so may have adverse
performance consequences for typed SJS code.


# Extending jscomp

Extend [src/js/runtime/library.js](src/js/runtime/library.js) to support more native functionalities in generated JavaScript.
Extend [src/js/runtime/clibrary.js](src/js/runtime/clibrary.js) to support more native functionalities in generated C.
Modify [src/js/runtime/instructions.js](src/js/runtime/instructions.js) to fully implement all the instructions generated by compile.js.

# Limitations:
 *  No support for arguments array
 *  No support for getters or setters
 *  No support for eval and with
 *  No support for adding variables to the global scope
 


